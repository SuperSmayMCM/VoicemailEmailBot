<!DOCTYPE html>
{% extends 'base.html' %}

{% block title %}Script Logs{% endblock %}

{% block page_header %}
<header>
    <h1>Script Execution Logs</h1>
    <div class="controls">
        <a href="/" class="btn secondary">Back to Settings</a>
    </div>
</header>
{% endblock %}

{% block content %}
    <div class="raw-area" id="rawArea">
        <pre id="log-content">Loading logs...</pre>
    </div>
{% endblock %}

{% block scripts %}
<script>
    const logPre = document.getElementById('log-content');
    const rawArea = document.getElementById('rawArea');

    async function fetchLogs() {
        try {
            const response = await fetch('/get_log_data');
            if (response.ok) {
                const text = await response.text();
                // Only update if content has changed to avoid flicker
                if (logPre.textContent !== text) {
                    logPre.textContent = text;
                    // Scroll to the bottom when visible
                    logPre.scrollTop = logPre.scrollHeight;
                }
            } else {
                logPre.textContent = 'Error fetching logs. Server responded with status: ' + response.status;
            }
        } catch (error) {
            logPre.textContent = 'Failed to connect to the server to fetch logs.';
        }
    }

    // Fetch logs immediately on page load, then every 2 seconds
    fetchLogs();
    setInterval(fetchLogs, 2000);
</script>
{% endblock %}
